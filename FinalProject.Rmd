---
title: 'Final Project'
author: "Brynn VanHorn, Mackenzie Donaubauer, Samuel Husted"
date: "12/5/2023"
output: html_document
---
  
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## The Dataset

First, we grab the dataset and analyze the data.

```{r}
library(tidyverse)
starbucks_data <- read.csv("starbucks.csv")

str(starbucks_data)
summary(starbucks_data)

head(starbucks_data)
```
We clean the data by changing the type of columns from characters to numbers.
```{r}
numeric_columns <- c("Total.Fat..g.", "Caffeine..mg.")
starbucks_data[numeric_columns] <- lapply(starbucks_data[numeric_columns], as.numeric)

percentage_columns <- c("Vitamin.A....DV.", "Vitamin.C....DV.", "Calcium....DV.", "Iron....DV.")

starbucks_data[percentage_columns] <- lapply(starbucks_data[percentage_columns], function(x) {
  as.numeric(sub("%", "", x))/100
})

str(starbucks_data)
```

Here we make a bar graph where x is the number of calories and y is the frequency of beverages with x number of calories.
```{r}
ggplot(starbucks_data, aes(x = Calories)) +
  geom_histogram(binwidth = 50, fill = "skyblue", color = "black") +
  labs(title = "Distribution of Calories in Starbucks Beverages",
       x = "Calories", y = "Frequency")
```


We do more cleaning of the data by getting rid of the periods at the end of each column name and replacing them with one underscore.
```{r}
starbucks_data <- starbucks_data %>%
  rename_all(~str_replace_all(., "[[:space:](.)]", "_"))

starbucks_data <- starbucks_data %>%
  rename_all(~str_replace_all(., "_+", "_"))

starbucks_data <- starbucks_data %>%
  rename_all(~str_replace(., "_$", ""))

# Drop rows with NA values
starbucks_data <- na.omit(starbucks_data)

print(colnames(starbucks_data))
```
Here we make a correlation matrix with columns we believe would be great candidates for determining number of calories. Then we graphed scatterplots of the top 4 highest correlations with Calories. 
```{r}
selected_columns <- c("Sodium_mg", "Cholesterol_mg", "Dietary_Fibre_g", "Protein_g", "Calcium_DV", "Calories", "Total_Fat_g", "Sugars_g", "Total_Carbohydrates_g")
selected_data <- starbucks_data[selected_columns]

correlation_matrix <- cor(selected_data)
print(correlation_matrix)

scatterplot_totalfat <- ggplot(starbucks_data, aes(x = Total_Fat_g, y = Calories)) +
  geom_point(color = "darkmagenta") +
  geom_smooth(method = "lm", se = FALSE, color = "red") + 
  labs(title = "Scatter Plot Matrix for Calories vs Total Fat",
       x = "Total Fat (g)", y = "Calories")
scatterplot_totalfat

scatterplot_sugar <- ggplot(starbucks_data, aes(x = Sugars_g, y = Calories)) +
  geom_point(color = "blue3") +
  geom_smooth(method = "lm", se = FALSE, color = "red") + 
  labs(title = "Scatter Plot Matrix for Calories vs Sugar",
       x = "Sugars (g)", y = "Calories")
scatterplot_sugar

scatterplot_carbs <- ggplot(starbucks_data, aes(x = Total_Carbohydrates_g, y = Calories)) +
  geom_point(color = "darkgreen") +
  geom_smooth(method = "lm", se = FALSE, color = "red") + 
  labs(title = "Scatter Plot Matrix for Calories vs Total Carbohydrates (g)",
       x = "Total Carbohydrates (g)", y = "Calories")
scatterplot_carbs

scatterplot_cholesterol <- ggplot(starbucks_data, aes(x = Cholesterol_mg, y = Calories)) +
  geom_point(color = "orange") +
  geom_smooth(method = "lm", se = FALSE, color = "red") + 
  labs(title = "Scatter Plot Matrix for Calories vs Cholesterol (mg)",
       x = "Total Carbohydrates (g)", y = "Calories")
scatterplot_cholesterol
```

Here we make a boxplot where we graphed the number of calories in relation to the catagory of beverage.
```{r}
boxplot_calories <- ggplot(starbucks_data, aes(x = Beverage_category, y = Calories, fill = Beverage_category)) +
  geom_boxplot() +
  labs(title = "Boxplot of Calories by Beverage Type",
       x = "Beverage Type", y = "Calories") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) + 
  scale_fill_discrete()  

print(boxplot_calories)
```

Lastly, we grabbed real data from a Dunkin' Donuts Nutrition document and tested our accuracy of calculating the number of calories.
```{r}
#https://www.dunkindonuts.com/content/dam/dd/pdf/nutrition.pdf

carbs_linear_model <- lm(Calories ~ Total_Carbohydrates_g, data = starbucks_data)
sugar_linear_model <- lm(Calories ~ Sugars_g, data = starbucks_data)
fat_linear_model <- lm(Calories ~ Total_Fat_g, data = starbucks_data)
#chole_linear_model <- lm(Calories ~ Cholesterol_mg, data = starbucks_data)
multiple_linear_model <- lm(Calories ~ Total_Carbohydrates_g + Sugars_g + Total_Fat_g 
                            #+ Cholesterol_mg
                            , data = starbucks_data)

new_data <- data.frame(
  Beverage = c("Original Hot Chocolate - Medium", "Hot Coffee - Large", "Hot Coffee with Sugar - Medium", "French Vanilla Swirl Frozen Coffee with Cream - Large"), 
  Calories = c(330, 5, 110, 1110), 
  Total_Carbohydrates_g = c(59, 0, 26, 180), 
  Total_Fat_g = c(10, 0, 0, 40), 
  Sugars_g = c(46, 0, 26, 169)
  #, Cholesterol_mg = c(0, 0, 0, 130)
  )

carb_predicted_calories <- predict(carbs_linear_model, newdata = new_data)
sugar_predicted_calories <- predict(sugar_linear_model, newdata = new_data)
fat_predicted_calories <- predict(fat_linear_model, newdata = new_data)
#chole_predicted_calories <- predict(chole_linear_model, newdata = new_data)
multi_predicted_calories <- predict(multiple_linear_model, newdata = new_data)

new_data_with_predictions <- cbind(new_data$Beverage, new_data$Calories, 
                                   #chole_predicted_calories, 
                                   carb_predicted_calories, sugar_predicted_calories, fat_predicted_calories, multi_predicted_calories)

colnames(new_data_with_predictions)[1] <- "Beverage"
colnames(new_data_with_predictions)[2] <- "Calories"

# Print the data frame with predicted calories
new_data_with_predictions

#summary(carbs_linear_model)

```
Unfortunately, we took out cholesterol from this table as the accuracy was greatly reduced with Cholesterol in. If you want to check it out, uncomment all rows relating to obtaining cholesterol predicted values.
